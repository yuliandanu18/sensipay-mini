
PATCH: Parent Login & Permission Khusus (Sensipay-mini)

1) Migration relasi orang tua ke siswa
--------------------------------------
File: database/migrations/2025_11_17_000600_add_parent_user_id_to_students_table.php

- Menambahkan kolom students.parent_user_id yang mengacu ke tabel users.
- Setelah menyalin file, jalankan:

    php artisan migrate

2) Patch model Student (EDIT MANUAL)
------------------------------------
Buka: app/Models/Student.php

Tambahkan relasi ini di dalam class Student:

    public function parentUser()
    {
        return $this->belongsTo(\App\Models\User::class, 'parent_user_id');
    }

Dengan begitu, kita bisa akses:
    $student->parentUser

3) Update ParentDashboardController
-----------------------------------
File baru di patch ini: app/Http/Controllers/Sensipay/ParentDashboardController.php

- Controller ini sekarang:
  - Jika user.role == 'parent' -> hanya melihat invoice milik siswa yang parent_user_id = user.id
  - Jika role lain (owner / operational / academic) -> bisa lihat semua untuk keperluan monitoring.

4) Route proteksi parent (EDIT MANUAL)
--------------------------------------
Buka: routes/sensipay.php

Jika kamu memakai prefix & middleware, contoh yang direkomendasikan:

    use App\Http\Controllers\Sensipay\ParentDashboardController;

    Route::middleware(['web','auth'])
        ->prefix('sensipay')
        ->as('sensipay.')
        ->group(function () {
            Route::get('parent/dashboard', [ParentDashboardController::class, 'index'])
                ->middleware('role:parent,owner,operational_director,academic_director')
                ->name('parent.dashboard');
        });

Jika struktur kamu sudah punya group 'sensipay', cukup tambahkan:

    Route::get('parent/dashboard', [ParentDashboardController::class, 'index'])
        ->middleware('role:parent,owner,operational_director,academic_director')
        ->name('parent.dashboard');

Pastikan:
- Middleware 'auth' tetap aktif (entah di group atau per route)
- Middleware 'role' sudah support nilai 'parent'

5) Cara set akun parent
-----------------------
Sementara, akun orang tua bisa dibuat manual via Tinker:

    php artisan tinker

    use App\Models\User;
    use App\Models\Student;

    $u = User::create([
        'name' => 'Orang Tua Dawud',
        'email' => 'ortu.dawud@example.com',
        'password' => bcrypt('password-rahasia'),
        'role' => 'parent',
    ]);

    $s = Student::where('name','LIKE','%Dawud%')->first();
    $s->parent_user_id = $u->id;
    $s->save();

Setelah itu:
- Ortu login pakai email + password tadi
- Buka /sensipay/parent/dashboard
- Hanya melihat tagihan anaknya sendiri.

6) Redirect setelah login (opsional)
------------------------------------
Jika ingin setelah login otomatis mengarahkan berdasarkan role,
bisa buat controller khusus atau modify login redirect di Auth:

Contoh sederhana:
- Di RouteServiceProvider, set HOME = '/role-redirect'
- Buat controller yang cek user->role dan redirect:
  - parent -> /sensipay/parent/dashboard
  - owner  -> /sensijet/dashboard-owner
  - dll.

(Pengaturan ini tidak dipaksa di patch, supaya tidak bentrok dengan setup auth kamu sekarang.)
